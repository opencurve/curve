/*
 *  Copyright (c) 2023 NetEase Inc.
 *
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 */

/*
 * Project: Curve
 * Created Date: 2023-07-12
 * Author: Jingli Chen (Wine93)
 */

#include "libcurvefs/libcurvefs.h"
#include "io_opencurve_curve_fs_CurveFS.h"

static inline struct curvefs_mount_point* get_curvefs_mount_point(jlong j_mp) {
	return (struct curvefs_mount_point*)j_mp;
}

JNIEXPORT jlong JNICALL Java_io_opencurve_curve_fs_CurveFS_nativeCurveFScreate
  (JNIEnv *, jclass) {
    curvefs_mount_point* mount_point;
    auto rc = curvefs_create(&mount_point);
    if (rc != 0) {
        return rc;
    }
    return (long)(mount_point);
}

JNIEXPORT jint JNICALL Java_io_opencurve_curve_fs_CurveFS_nativeCurveFSMount
  (JNIEnv *, jclass, jlong j_mp) {
    struct curvefs_mount_point* mp = get_curvefs_mount_point(j_mp);
    return curvefs_mount(mp);
}

JNIEXPORT jint JNICALL Java_io_opencurve_curve_fs_CurveFS_nativeCurveFSMkdir
  (JNIEnv *, jclass, jlong j_mp, jstring j_path, jint j_mode) {
    struct curvefs_mount_point* mp = get_curvefs_mount_point(j_mp);
    return curvefs_mkdir(mp, j_path, j_mode);
}

JNIEXPORT jint JNICALL Java_io_opencurve_curve_fs_CurveFS_nativeCurveFSRmdir
  (JNIEnv *, jclass, jlong j_mp, jstring j_path) {
    struct curvefs_mount_point* mp = get_curvefs_mount_point(j_mp);
    return curvefs_rmdir(mp, j_path);
}