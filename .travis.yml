language: c++
sudo: required
env:
services:
  - docker
    #before_install: sudo apt-get install fio -y
intall: 
  - sudo docker pull chenyunhui/untest:1.0.0
  - sudo pip install codecov
script:
  - WOCKSPACE=`pwd`
  - sudo docker run -d --privileged --name curve --volume $WOCKSPACE:/curve chenyunhui/untest:1.0.0 /bin/bash /etc/rc.local 
  - sudo docker exec -it curve  /bin/bash -c "cd /curve/  && ls"
  - sudo docker exec -it curve  /bin/bash -c "cd /curve/  && bash untest.sh"
  - cp gen-coverage.py bazel-bin
  - cp check_coverage.sh bazel-bin
  - cd bazel-bin/
  - python gen-coverage.py
  - bash check_coverage.sh
  - cd $WOCKSPACE
  - cp bazel-bin/coverage/index.html .
after_success:
  - bash <(curl -s https://codecov.io/bash)
