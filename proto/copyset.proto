syntax="proto2";

import "proto/common.proto";

package curve.chunkserver;

option cc_generic_services = true;

message CopysetRequest {
    // logicPoolId 实际上 uint16，但是 proto 没有 uint16
    required uint32 logicPoolId = 1;
    required uint32 copysetId = 2;
    repeated string peerid = 3; // 当前复制组配置，可以为空
};

enum COPYSET_OP_STATUS {
    COPYSET_OP_STATUS_SUCCESS           = 0;
    COPYSET_OP_STATUS_EXIST             = 1;  // copyset node 已经存在
    COPYSET_OP_STATUS_COPYSET_NOTEXIST  = 2;
    COPYSET_OP_STATUS_FAILURE_UNKNOWN   = 3;
};

message CopysetResponse {
    optional COPYSET_OP_STATUS status = 1;
    optional string redirect = 2;  // 自己不是 leader，重定向给 leader
};

message Copyset {
    required uint32 logicPoolId = 1;
    required uint32 copysetId   = 2;
    repeated common.Peer peers  = 3;
}

message CopysetRequest2 {
    repeated Copyset copysets       = 1;
};

message CopysetResponse2 {
    optional COPYSET_OP_STATUS status = 1;
}

message CopysetStatusRequest {
    optional uint32 logicPoolId = 1;
    optional uint32 copysetId   = 2;
    optional common.Peer peer  = 3;
}

// hash并不一定是hash value，所以是字符串类型，可以用json
// 包裹，这样可以任意的扩展
message CopysetStatusResponse {
    optional COPYSET_OP_STATUS status = 1;
    optional string hash = 2;
}

service CopysetService {
    rpc CreateCopysetNode (CopysetRequest) returns (CopysetResponse);

    rpc CreateCopysetNode2 (CopysetRequest2) returns (CopysetResponse2);

    rpc GetCopysetStatus (CopysetStatusRequest) returns (CopysetStatusResponse);
};
