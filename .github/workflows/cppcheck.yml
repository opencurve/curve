name: cppcheck-action
on: [push, pull_request]

jobs:
  cppcheck:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3  
      - uses: deep5050/cppcheck-action@main 
        with:
          inconclusive: disable
          other_options: "--suppress=syntaxError:* --suppress=danglingTemporaryLifetime:* --suppress=deallocuse:* --suppress=uninitvar:* --suppress=unknownMacro:* --suppress=ctuOneDefinitionRuleViolation:*"
      - name: Error check
        run: |
            if grep -qF 'error: ' cppcheck_report.txt; then
              exit 1
            fi 
      - uses: actions/upload-artifact@v3
        if: always()
        with:
          name: cppcheck
          path: cppcheck_report.txt
